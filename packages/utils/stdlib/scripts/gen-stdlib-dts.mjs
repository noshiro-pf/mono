// @ts-check

import { readdirSync, writeFileSync } from 'node:fs';
import { dirname, join } from 'node:path';
import { fileURLToPath } from 'node:url';

const thisDir = dirname(fileURLToPath(import.meta.url));

const stdlibDir = join(thisDir, '../dist');

/**
 * ```js
 * [
 *   'lib.d.ts',
 *   'lib.dom.d.ts',
 *   'lib.dom.iterable.d.ts',
 *   ```
 * ]
 * ...
 */
const stdlibFiles = readdirSync(stdlibDir);

/** @type {readonly string[]} */
const stdlibs = stdlibFiles
  .filter((f) => f !== 'utils.d.ts')
  .map((filename) => `/// <reference path="./dist/${filename}" />`);

const result = [
  '/* eslint-disable @typescript-eslint/triple-slash-reference */',
  '',
  '/// <reference no-default-lib="true"/>',
  '',
  ...stdlibs,
  '',
  `// Created at: ${new Date().toISOString()}`,
  "// This file is generated by 'packages/utils/stdlib/scripts/gen-stdlib-dts.js'",
].join('\n');

writeFileSync(`${thisDir}/../stdlib.d.ts`, result);
